@using CollectionManager.WEB.Extensions
@model Entities.DTO.Items.ItemDetailsToReturnDto

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Details</title>
</head>
<body>

    <div>
        <h4>ItemDetailsToReturnDto</h4>
        <hr />
        <dl class="row">
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Id)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Id)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Name)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Name)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.CollectionName)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.CollectionName)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.OwnerName)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.OwnerName)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.CollectionId)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.CollectionId)
            </dd>
            @foreach (var value in Model.CustomFieldValues)
            {
                <dt class="col-sm-2">
                    @Html.DisplayFor(x => value.Name)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(x => value.Value)
                </dd>
            }
            
            <dt class="col-sm-2">
                Tags
            </dt>
            <dd class="col-sm-10">
                @string.Join(", ", Model.Tags.Select(x => x.Name))
            </dd>
        </dl>
        
        @if (User.Identity.IsAuthenticated)
        {
            if (Model.Likes.Any(x => x.AuthorId == User.GetUserId()))
            {
                <button class="btn btn-outline-danger" onclick="location.href = '@Url.Action("RemoveLike", "Likes", new {itemId = Model.Id})'"><i class="bi bi-heart"></i> @Model.Likes.Count()</button>
            }
            else
            {
                <button class="btn btn-outline-secondary" onclick="location.href = '@Url.Action("PutLike", "Likes", new {itemId = Model.Id})'"><i class="bi bi-heart"></i> @Model.Likes.Count()</button>
            }

            <div class="form-outline mb-4">
                <form asp-action="PostComment" asp-controller="Comments">

                    <input type="hidden" name="itemId" value="@Model.Id"/>
                    @Html.TextBox("CommentText", null, new {data_val="true", data_val_required="Text is required", @class= "form-control", placeholder = "Type comment..." })
                    <span  class="text-danger" data-valmsg-for="CommentText" data-valmsg-replace="true"></span><br/>

                    <input type="submit" value="Post" class="btn btn-primary"/>
                </form>
            </div>
        }
        
        @if (Model.Comments.Any())
        {
            <div class="container my-5 py-5">
                <div class="row d-flex justify-content-center">
                    <div class="col-md-12 col-lg-10">
                        <div class="card text-dark">
                            @foreach (var comment in Model.Comments.OrderByDescending(x => x.Date))
                            {
                                <div class="card-body p-4">
                                    <div class="d-flex flex-start">              
                                        <div>
                                            <h6 class="fw-bold mb-1">@comment.AuthorName</h6>
                                            <div class="d-flex align-items-center mb-3">
                                                <p class="mb-0">
                                                    @comment.Date.ToString("F")
                                                </p>
                                            </div>
                                            <p class="mb-0">
                                                @comment.Text
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
        
    </div>
</body>
</html>
